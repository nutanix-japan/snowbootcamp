{"status":{},"contains_secrets":false,"product_version":"3.3.0","spec":{"description":"Run this Blueprint ONLY AFTER you have requested a ServiceNow Developer Instance from https:\/\/developer.servicenow.com\/ and have activated the following plugins through the ServiceNow Developer Portal for your instance: Discovery, Event Management, and ServiceNow IntegrationHub Installer","resources":{"client_attrs":{"None":{"y":-26.1414490986,"x":-392.7069778468},"b39046ae_deployment":{"y":-28.1414490986,"x":-854.7069778468}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"56af526b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"12936f8e_runbook","main_task_local_reference":{"kind":"app_task","name":"56af526b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9592ed52_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ecea4dd_runbook","main_task_local_reference":{"kind":"app_task","name":"9592ed52_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5959c859_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3bc93e59_runbook","main_task_local_reference":{"kind":"app_task","name":"5959c859_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b500460a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4a8e21e2_runbook","main_task_local_reference":{"kind":"app_task","name":"b500460a_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a88b201a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"15b440d5_runbook","main_task_local_reference":{"kind":"app_task","name":"a88b201a_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MIDServer","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VM1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"GetPCIP"}],"name":"49a264dc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"VM1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"GetPCIP","attrs":{"exit_status":[],"script":"jwt = '@@{calm_jwt}@@'\n\n# Get PC IP and PE uuid\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/prism_central'\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer {}'.format(jwt)}\n\nr = urlreq(api_url, verb='GET', headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n\n    pc_ip = resp['resources']['pc_vm_list'][0]['nic_list'][0]['ip_list'][0]\n    pe_uuid= resp['resources']['pc_vm_list'][0]['cluster_reference']['uuid']\n    storage_container = resp['resources']['pc_vm_list'][0]['container_uuid']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\nprint(\"PC_IP={}\".format(pc_ip))\nprint(\"PE_UUID={}\".format(pe_uuid))\nprint(\"SC_UUID={}\".format(storage_container))","eval_variables":["PC_IP"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"12893f56_runbook","main_task_local_reference":{"kind":"app_task","name":"49a264dc_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VM1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"93e413be_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a0734bb3_runbook","main_task_local_reference":{"kind":"app_task","name":"93e413be_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"VM1","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"root"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"SNOWMID-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"Primary","uuid":"6a7f4fd6-41c1-402b-b5a9-8ce5739d29cd"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n\nchpasswd:\n  list: |\n    root:@@{root.secret}@@\n  expire: False\nssh_pwauth:   true"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"68e2d0f5-06f1-4dfe-962f-cc9a199b1364","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7.qcow2","uuid":"cdf49d1c-bd55-42d9-9006-29b6445df742"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"root","cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MIDServer"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"SeleniumSetup"},{"kind":"app_task","name":"SNOWInstanceSetup"},{"kind":"app_task","name":"SNOWInstanceCleanup"},{"kind":"app_task","name":"MIDServerSetup"},{"kind":"app_task","name":"CalmPluginConfig"},{"kind":"app_task","name":"SNOWCMDBConfig"},{"kind":"app_task","name":"SNOWChangePW"}],"name":"ff04da96_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SeleniumSetup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SNOWInstanceSetup"}},{"from_task_reference":{"kind":"app_task","name":"SNOWInstanceSetup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SNOWInstanceCleanup"}},{"from_task_reference":{"kind":"app_task","name":"SNOWInstanceCleanup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MIDServerSetup"}},{"from_task_reference":{"kind":"app_task","name":"MIDServerSetup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"CalmPluginConfig"}},{"from_task_reference":{"kind":"app_task","name":"CalmPluginConfig"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SNOWCMDBConfig"}},{"from_task_reference":{"kind":"app_task","name":"SNOWCMDBConfig"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SNOWChangePW"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SeleniumSetup","attrs":{"exit_status":[],"script":"sudo yum install -y python3\nsudo yes | pip3 install selenium\n\nsudo yum install -y firefox \nsudo yum install -y wget unzip zip\nsudo yum install -y  glibc.i686\nwget https:\/\/github.com\/mozilla\/geckodriver\/releases\/download\/v0.26.0\/geckodriver-v0.26.0-linux64.tar.gz\ntar -xvzf geckodriver-v0.26.0-linux64.tar.gz\nsudo cp geckodriver \/usr\/local\/bin\/geckodriver\n\n#echo \"JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk\" >> ~\/.bash_profile java-1.8.0-openjdk.x86_64","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SNOWInstanceSetup","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/ConfigureSNOW.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.common.action_chains import ActionChains\nimport os, sys, time\n\noptions = Options()\noptions.headless = True\nprofile = webdriver.FirefoxProfile()\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(30)\n\n# Service Now instance id need to be changes in the url\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\/\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\nsnow_users = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_user_list.do?sysparm_userpref_module%3Dc5aa0fff0a0a0aa7009a39da035ea396%26sysparm_clear_stack%3Dtrue\"\nsnow_groups = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_user_group_list.do?sysparm_userpref_module%3Dc5aa68730a0a0aa70036ced8b58ca05c%26sysparm_clear_stack%3Dtrue\"\nuser_criteria_plugin_url = \"https:\/\/@@{SNOWInstanceURL}@@\/\\$allappsmgmt.do?sysparm_redirect%3Dtrue&sysparm_search=User%20Criteria%20Scoped%20API\"\nglide_validate_property_url = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_properties_list.do?sysparm_query=nameSTARTSWITHglide.sc.guide.tab.validate&sysparm_first_row=1&sysparm_view=&sysparm_choice_query_raw=&sysparm_list_header_search=true\"\nglide_reset_cascade_url = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_properties_list.do?sysparm_query=nameSTARTSWITHglide.sc.reset_cascade&sysparm_first_row=1&sysparm_view=&sysparm_choice_query_raw=&sysparm_list_header_search=true\"\ntables_url = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_db_object_list.do?sysparm_query=labelSTARTSWITHCatalog%20Client%20Scripts&sysparm_first_row=1&sysparm_view=&sysparm_choice_query_raw=&sysparm_list_header_search=true\"\ndiscovery_mapping_plugin_url = \"https:\/\/@@{SNOWInstanceURL}@@\/\\$allappsmgmt.do?sysparm_redirect%3Dtrue&sysparm_search=Discovery%20and%20Service%20Mapping%20Patterns\"\nsys_property = \"sys_properties.list\"\nproperty_name = \"glide.sc.guide.tab.validate\"\n\n###Login to the ServiceNow Instance\nprint('Logging in to ' + snow_url)\ntry:\n    browser.get(snow_url)\n    #frame = browser.find_element_by_xpath\n    browser.switch_to.frame('gsft_main')\n    browser.find_element_by_id(\"user_name\").send_keys(snow_username)\n    browser.find_element_by_id(\"user_password\").send_keys(snow_password)\n    browser.find_element_by_id(\"sysverb_login\").click()\n    print('Logged in to SNOW')\n    browser.switch_to_default_content()\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure while logging in to SNOW: ' + str(e))\n\n\n#Create midserver user\nprint('Creating midserver user account')\ntry:\n    browser.get(snow_users)\n    browser.find_element_by_id(\"sysverb_new\").click()\n    time.sleep(25)\n    browser.find_element_by_xpath(\"\/\/*[@id='sys_user.user_name']\").send_keys(\"midserver\")\n    browser.find_element_by_xpath(\"\/\/*[@id='sys_user.user_password']\").send_keys(\"nutanix\/4u\")\n    browser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\n    time.sleep(5)\n    browser.get(snow_users)\n    time.sleep(10)\n    browser.find_element_by_link_text(\"midserver\").click()\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/\/*[@id='tabs2_list']\/span[2]\/span\/span[2]\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sysverb_edit_m2m\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"_sys_user_role\").send_keys(\"mid_server\")\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/\/*[text()='mid_server']\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"add_to_collection_button\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"select_0_sysverb_save\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sysverb_update\").click()\n    time.sleep(15)\n    print('midserver user account created')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure while creating midserver account: ' + str(e))\n\n    \n#User Criteria Scoped API Plugin Activation\nprint('Activating User Criteria Scoped API plugin')\ntry:\n    browser.get(user_criteria_plugin_url)\n    browser.find_element_by_xpath(\"\/\/*[@id='appSection']\/div\/render-plugin\/div\/div[1]\/div[2]\/div[2]\/div\/div\/button\").click()\n    time.sleep(10)\n    browser.switch_to.frame(\"pluginActivateFrame\")\n    browser.find_element_by_id(\"ok_button\").click()\n    print('Sleeping for 10 minutes while User Criteria Scoped API plugin is activated')\n    browser.implicitly_wait(600)\n    browser.find_element_by_id(\"sysparm_button_close\").click()\n    print('User Criteria Scoped API plugin activated')\n    browser.switch_to_default_content()\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure trying to activate User Criteria Scoped API plugin: ' + str(e))\n##glide.sc.guide.tab.validate Property Change\nprint('Updating glide.sc.guide.tab.validate property value')\ntry:\n    browser.get(glide_validate_property_url)\n    browser.find_element_by_link_text(\"glide.sc.guide.tab.validate\").click()\n    time.sleep(10)\n    browser.find_element_by_id(\"sys_properties.value\").clear()\n    browser.find_element_by_id(\"sys_properties.value\").send_keys(\"true\")\n    browser.find_element_by_id(\"sysverb_update\").click()\n    time.sleep(20)\n    print('glide.sc.guide.tab.validate updated')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure trying to update glide.sc.guide.tab.validate: ' + str(e))\n##Table_Access_Script\nprint('Updating table permissions for Calm plugin')\ntry:\n    browser.get(snow_url)\n    browser.find_element_by_id(\"filter\").send_keys(\"sys.scripts.do\")\n    browser.find_element_by_id(\"filter\").send_keys(Keys.ENTER)\n    time.sleep(20)\n    browser.switch_to.frame('gsft_main')\n    text_area = browser.find_element_by_xpath(\"\/\/*[@id='runscript']\")\n    text_area.send_keys(\n        \"var table_array_string='sys_user_has_role,sys_user_group,sys_user_grmember,sys_group_has_role,sc_category,\"\n        \"sc_catalog,item_option_new,catalog_ui_policy,catalog_script_client,user_criteria,question,question_choice,sysapproval_approver';\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"var query_string='nameIN'+ table_array_string;\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"var db_objectGR=new GlideRecord('sys_db_object');\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.addEncodedQuery(query_string);\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.query();\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"while(db_objectGR.next())\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"{\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"gs.error(db_objectGR.label.getDisplayValue()+\\\"::\\\"+db_objectGR.read_access.getDisplayValue()+'-->');\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.read_access=true;\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.create_access=true;\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.update_access=true;\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.delete_access=false;\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"db_objectGR.update();\")\n    text_area.send_keys(Keys.ENTER)\n    text_area.send_keys(\"}\")\n    browser.find_element_by_xpath(\"\/html\/body\/form\/input[2]\").click()\n    print('Table permissions updated')\n    time.sleep(20)\n    browser.switch_to_default_content()\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure updating table permissions: ' + str(e))\n\n##Upload & Install build (v1.0+1.1)\nprint('Installing Calm plugin v1.0+v1.1')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm v1.1(v1.0+v1.1).xml\")\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"Nutanix Calm\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    try:\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n    except:\n        print('Skip remote update link not found, committing update set')\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(600)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('Calm v1.0+v1.1 plugin installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing Calm v1.0+v1.1 plugin: ' + str(e))\n\n######Upload & Install build (v1.2_5)\nprint('Installing Calm plugin v1.2.5')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm V1.2_5.xml\")\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"Nutanix Calm V1.2_5\").click()\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(90)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    try:\n        browser.find_element_by_link_text(\"Skip remote update\").click()\n        browser.implicitly_wait(10)\n    except:\n        print('Skip remote update link not found, committing update set')\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(600)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('Calm v1.2.5 plugin installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing Calm v1.2.5 plugin: ' + str(e))\n\n######Upload & Install build (v1.3_4)\nprint('Installing Calm plugin v1.3.4')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm V1.3_4.xml\")\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"Nutanix Calm V1.3_4\").click()\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(90)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(600)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('Calm v1.3.4 plugin installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing Calm v1.3.4 plugin: ' + str(e))\n\n###glide.sc.reset_cascade Property Change\nprint('Updating glide.sc.reset_cascade property value')\ntry:\n    browser.get(glide_reset_cascade_url)\n    browser.find_element_by_link_text(\"glide.sc.reset_cascade\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sys_properties.value\").clear()\n    browser.find_element_by_id(\"sys_properties.value\").send_keys(\"true\")\n    browser.find_element_by_id(\"sysverb_update\").click()\n    time.sleep(15)\n    print('glide.sc.reset_cascade updated')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure updating glide.sc.reset_cascade property value: ' + str(e))\n\n######Upload & Install build (v1.4.2)\nprint('Installing Calm plugin v1.4.2')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm V1.4.2.xml\")\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"Nutanix Calm V1.4.2\").click()\n    browser.implicitly_wait(5)\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(90)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    browser.implicitly_wait(10)\n    #browser.find_element_by_link_text(\"Skip remote update\").click()\n    #browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='ok_button']\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('Calm v1.4.2 plugin installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing Calm v1.4.2 plugin: ' + str(e))    \n\n\n######Upload & Install build (v1.4.3)\nprint('Installing Calm plugin v1.4.3')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm V1.4.3.xml\")\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"Nutanix Calm V1.4.3\").click()\n    browser.implicitly_wait(5)\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(90)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('Calm v1.4.3 plugin installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing Calm v1.4.3 plugin: ' + str(e))  \n\n######Upload & Install \"Nutanix Calm - User Approval\" Workflow\nprint('Installing custom Calm User Approval workflow')\ntry:\n    browser.get(snow_url + \"\/sys_remote_update_set_list.do\")\n    browser.find_element_by_link_text(\"Import Update Set from XML\").click()\n    time.sleep(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='attachFile']\").send_keys(\"\/tmp\/Nutanix Calm User Approval Workflow 1.0.xml\")\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/html\/body\/div[2]\/form\/div[3]\/div[2]\/input\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_link_text(\"User Approval Workflow\").click()\n    browser.implicitly_wait(5)\n    browser.find_element_by_id(\"preview_update_set\").click()\n    browser.implicitly_wait(90)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    browser.implicitly_wait(10)\n    browser.find_element_by_xpath(\"\/\/*[@id='c38b2cab0a0a0b5000470398d9e60c36']\").click()\n    browser.implicitly_wait(300)\n    browser.find_element_by_xpath(\"\/\/*[@id='sysparm_button_close']\").click()\n    print('User Approval Workflow installed')\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure installing custom Calm User Approval workflow: ' + str(e))  \n\n#Create Calm Users group\nprint('Creating local Calm Users group')\ntry:\n    browser.get(snow_groups)\n    browser.find_element_by_id(\"sysverb_new\").click()\n    time.sleep(5)\n    browser.find_element_by_xpath(\"\/\/*[@id='sys_user_group.name']\").send_keys(\"Calm Users\")\n    browser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\n    time.sleep(5)\n    browser.find_element_by_link_text(\"Calm Users\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sysverb_edit_m2m\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"_sys_user_role\").send_keys(\"x_nuta2_nutanix_ca.user\")\n    browser.find_element_by_xpath(\"\/\/*[text()='x_nuta2_nutanix_ca.user']\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"add_to_collection_button\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"select_0_sysverb_save\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sysverb_update\").click()\n    print('Calm Users group created')\n    time.sleep(15)\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure creating local Calm Users group: ' + str(e))  \n    \n#Create Nutanix Calm users\nprint('Creating local operator user accounts')\ntry:\n    browser.get(snow_users)\n    for x in range(1, 21):\n        name = \"operator{}\".format('%02d' % x)\n\n        browser.find_element_by_id(\"sysverb_new\").click()\n        time.sleep(5)\n        browser.find_element_by_xpath(\"\/\/*[@id='sys_user.user_name']\").send_keys(name)\n        browser.find_element_by_xpath(\"\/\/*[@id='sys_user.user_password']\").send_keys(\"Nutanix/4u\")\n        browser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\n        time.sleep(5)\n        browser.find_element_by_link_text(name).click()\n        time.sleep(5)\n        browser.find_element_by_xpath(\"\/\/*[@id='tabs2_list']\/span[3]\/span\/span[2]\").click()\n        time.sleep(2)\n        browser.find_element_by_xpath(\"\/html\/body\/div[2]\/div[2]\/div\/div[3]\/span\/div[2]\/div[1]\/div\/div[1]\/button[3]\").click()\n        time.sleep(5)\n        browser.find_element_by_id(\"_sys_user_group\").send_keys(\"Calm Users\")\n        time.sleep(2)\n        browser.find_element_by_xpath(\"\/\/*[text()='Calm Users']\").click()\n        browser.find_element_by_id(\"add_to_collection_button\").click()\n        time.sleep(2)\n        browser.find_element_by_id(\"select_0_sysverb_save\").click()\n        time.sleep(5)\n        browser.find_element_by_id(\"sysverb_update\").click()\n        time.sleep(10)\n        print('{} user account created'.format(name))\nexcept Exception as e:\n    browser.quit()\n    sys.exit('Failure creating local calm users: ' + str(e))\n    \n\n#Discovery and Service Mapping Patterns Plugin Activation (includes CMDB CI Class Models as prerequisite)\nfor x in range(3):\n    try:\n        browser.get(discovery_mapping_plugin_url)\n        time.sleep(45)\n        element = browser.find_element_by_css_selector(\"b\")\n        actions = ActionChains(browser)\n        actions.move_to_element(element).click_and_hold().perform()\n        element = browser.find_element_by_id(\"select2-drop-mask\")\n        actions = ActionChains(browser)\n        actions.move_to_element(element).release().perform()\n\n        elements = browser.find_elements_by_xpath(\"\/\/*[starts-with(@id, 's2id_autogen')]\")\n        for element in elements:\n            try:\n                element.click()\n                element.send_keys(\"1.0.87\")\n                time.sleep(2)\n                element.send_keys(Keys.ENTER)\n                print (\"Set version to 1.0.87\")\n                break\n            except:\n                print (\"Wrong field\")\n\n        browser.find_element_by_xpath(\"\/\/*[text()='Install']\").click()\n        time.sleep(10)\n        browser.find_element_by_xpath(\"\/\/*[text()='Install']\").click()\n        print('CMDB CI Class Models and Discovery and Service Mapping Patterns plugins are being installed (takes ~30 minutes')\n        time.sleep(60)\n        break\n    except:\n        print('Failed to launch Discovery and Service Mapping Patterns plugin')\n        if x == 2:\n            sys.exit(\"Failed to launch Discovery and Service Mapping Patterns plugin 3 times\")\n            \nbrowser.quit()\n\nprint('Sleeping for 60 minutes to allow for plugin install before CMDB discovery configuration. You can use the SNOW instance with Calm in the meantime.')\ntime.sleep(3600)\nEOF\nif [ \"@@{CleanInstance}@@\" = \"TRUE\" ]\nthen\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20v1.1\\(v1.0%2Bv1.1\\).xml\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20V1.2_5.xml\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20V1.3_4.xml\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20V1.4.2.xml\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20V1.4.3.xml\n  wget -P \/tmp\/ https:\/\/raw.githubusercontent.com\/nutanixworkshops\/snowbootcamp\/main\/plugins\/Nutanix%20Calm%20User%20Approval%20Workflow%201.0.xml\n  python3 \/tmp\/ConfigureSNOW.py\nfi","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SNOWInstanceCleanup","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/SNOWCleanup.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.common.action_chains import ActionChains\nimport os, sys, time\n\noptions = Options()\noptions.headless = True\nprofile = webdriver.FirefoxProfile()\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(40)\n\n# Service Now instance id need to be changes in the url\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\n\nprint('Cleaning up previous Bootcamp config')\n\ntry:\n    print(\"Logging in to \" + snow_url)\n    ###Login to the ServiceNow Instance\n    browser.get(snow_url + \"\/nav_to.do?\")\n    #frame = browser.find_element_by_xpath\n    browser.switch_to.frame('gsft_main')\n    browser.find_element_by_id(\"user_name\").send_keys(snow_username)\n    browser.find_element_by_id(\"user_password\").send_keys(snow_password)\n    browser.find_element_by_id(\"sysverb_login\").click()\n    print('Logged in to ' + snow_url)\n    browser.switch_to.default_content()\n    browser.maximize_window()\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"Failure logging in to SNOW: \" + str(e))\n    print(\"FAILURE logging in to SNOW: \" + str(e))\n\ntry:\n    print(\"Removing existing Nutanix Discovery Schedule\")\n    browser.get(snow_url + \"\/discovery_schedule.do?sysparm_query=nameLIKENutanix\")\n    browser.find_element_by_id(\"sysverb_delete\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"ok_button\").click()\n    print(\"Nutanix Discovery Schedule removed\")\n    time.sleep(15)\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"Failure removing existing Nutanix Discovery Schedule: \" + str(e))\n    print(\"FAILURE removing existing Nutanix Discovery Schedule: \" + str(e))\n\ntry:\n    print(\"Removing existing Nutanix Discovery HTTP config\")\n    browser.get(snow_url + \"\/discovery_classy_http.do?sysparm_query=nameLIKENutanix\")\n    time.sleep(15)\n    try:\n        print(\"Changing SNOW application to edit record\")\n        browser.find_element_by_link_text(\"here\").click()\n    except:\n        print(\"SNOW application already correct\")\n    browser.find_element_by_id(\"sysverb_delete\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"ok_button\").click()\n    print(\"Nutanix Discovery HTTP config removed\")\n    time.sleep(15)\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"Failure removing existing Nutanix Discovery HTTP config: \" + str(e))\n    print(\"FAILURE removing existing Nutanix Discovery HTTP config: \" + str(e))\n\ntry:\n    print(\"Removing existing Nutanix Prism credential\")\n    browser.get(snow_url + \"\/basic_auth_credentials.do?sysparm_query=nameLIKENutanix\")\n    browser.find_element_by_id(\"sysverb_delete\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"ok_button\").click()\n    time.sleep(15)\n    browser.get(snow_url + \"\/sys_alias.do?sysparm_query=nameLIKENutanixPrism\")\n    browser.find_element_by_id(\"sysverb_delete\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"ok_button\").click()\n    print(\"Nutanix Prism credential removed\")\n    time.sleep(15)\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"Failure removing existing Nutanix Prism credential: \" + str(e))\n    print(\"FAILURE removing existing Nutanix Prism credential: \" + str(e))\n\ntry:\n    print(\"Deleting existing Nutanix Calm plugin inventory\")\n    browser.get(snow_url + \"\/x_nuta2_nutanix_ca_calm_plugin_configuration.do?sys_id=32fe0ea73785a300fdfc097973990ead&sysparm_view=&sysparm_record_target=&sysparm_record_row=1&sysparm_record_list=&sysparm_record_rows=1\")\n    browser.find_element_by_id(\"delete_inventory\").click()\n    time.sleep(2)\n    alert = browser.switch_to.alert\n    alert.accept()\n    print(\"Nutanix Calm plugin inventory deleted\")\n    time.sleep(15)\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"Failure deleting existing Calm plugin inventory: \" + str(e))\n    print(\"FAILURE deleting existing Calm plugin inventory: \" + str(e))\n\ntry:\n    print(\"Removing existing MID Server config\")\n    browser.get(snow_url + \"\/ecc_agent.do?sysparm_query=nameLIKESNOWMID\")\n    browser.find_element_by_id(\"sysverb_delete\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"ok_button\").click()\n    time.sleep(20)\n    print(\"Existing MID Server config deleted\")\n    time.sleep(15)\nexcept Exception as e:\n    #browser.quit()\n    #sys.exit(\"FAILURE deleting existing MID Server config: \" + str(e))\n    print('Previous Bootcamp staging config cleaned up')\nEOF\nif [ \"@@{CleanInstance}@@\" = \"FALSE\" ]\nthen\n  python3 \/tmp\/SNOWCleanup.py\nfi","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MIDServerSetup","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/DownloadMid.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nimport time\nimport os\n\noptions = Options()\noptions.headless = True\n\nprofile = webdriver.FirefoxProfile()\nprofile.set_preference('browser.download.panel.shown', False)\nprofile.set_preference('browser.download.folderList', 2)\nprofile.set_preference('browser.download.manager.showWhenStarting', False)\nprofile.set_preference('browser.download.dir', os.getcwd())\nprofile.set_preference('browser.helperApps.neverAsk.openFile', 'application\/zip')\nprofile.set_preference('browser.helperApps.neverAsk.saveToDisk', 'application\/x-gzip')\n\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(20)\n\nbrowser.get('https:\/\/@@{SNOWInstanceURL}@@\/mid_server_download_ui.do')\ntime.sleep(20)\nprint('Sleep over')\nbrowser.switch_to.frame('gsft_main')\nprint('entering creds')\nusername = browser.find_element_by_id('user_name')\npassword = browser.find_element_by_id('user_password')\nusername.send_keys('admin')\npassword.send_keys('@@{SNOWAdminPassword}@@')\nlogin_attempt = browser.find_element_by_id('sysverb_login')\nlogin_attempt.click()\nprint('Password entered')\n\ntime.sleep(30)\nbrowser.switch_to.default_content()\nbrowser.switch_to.frame('gsft_main')\ndownLink = browser.find_element_by_id('linux64')\nprint('DownLink Found')\ndownLink.click()\ntime.sleep(5)\nEOF\n\npython3 \/tmp\/DownloadMid.py\n\nsleep 5\n\nwhile [ true ];do if [ ! -f mid*.part ];then break;fi;done \n\nchmod 777 mid*\nmkdir -p @@{VM1.name}@@\nmv mid* @@{VM1.name}@@\/\ncd @@{VM1.name}@@\nunzip mid*\nrm -f mid*.*\ncd agent\nsed -i 's\/YOUR_INSTANCE.service-now.com\/@@{SNOWInstanceURL}@@\/g' config.xml\nsed -i 's\/YOUR_INSTANCE_USER_NAME_HERE\/midserver\/g' config.xml\nsed -i 's\/YOUR_INSTANCE_PASSWORD_HERE\/nutanix\\\/4u\/g' config.xml\nsed -i 's\/YOUR_MIDSERVER_NAME_GOES_HERE\/@@{VM1.name}@@\/g' config.xml\n\nsh start.sh\nsleep 30\n\necho \"Service started\"\n\ncat <<EOF > \/tmp\/ValidateMid.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nimport time\nimport os\n\noptions = Options()\noptions.headless = True\n\nprofile = webdriver.FirefoxProfile()\nprofile.set_preference('browser.download.panel.shown', False)\nprofile.set_preference('browser.download.folderList', 2)\nprofile.set_preference('browser.download.manager.showWhenStarting', False)\nprofile.set_preference('browser.download.dir', os.getcwd())\nprofile.set_preference('browser.helperApps.neverAsk.openFile', 'application\/zip')\nprofile.set_preference('browser.helperApps.neverAsk.saveToDisk', 'application\/x-gzip')\n\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\n\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\/nav_to.do?\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\n\n###Login to the ServiceNow Instance\nbrowser.get(snow_url)\ntime.sleep(30)\n#frame = browser.find_element_by_xpath\nbrowser.switch_to.frame('gsft_main')\ntime.sleep(5)\nbrowser.find_element_by_id(\"user_name\").send_keys(snow_username)\nbrowser.find_element_by_id(\"user_password\").send_keys(snow_password)\nbrowser.find_element_by_id(\"sysverb_login\").click()\nprint('Logged in to SNOW')\nbrowser.switch_to_default_content()\n\nbrowser.get(\"https:\/\/@@{SNOWInstanceURL}@@\/ecc_agent.do?sysparm_query=nameLIKE@@{VM1.name}@@\")\ntime.sleep(20)\nbrowser.find_element_by_link_text(\"Validate\").click()\nprint('Validate Clicked')\ntime.sleep(30)\n\nbrowser.get(\"https:\/\/@@{SNOWInstanceURL}@@\/ecc_agent.do?sysparm_query=nameLIKE@@{VM1.name}@@\")\ntime.sleep(20)\nbrowser.find_element_by_xpath(\"\/\/*[@id='tabs2_list']\/span[4]\/span\/span[2]\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/html\/body\/div[2]\/div[2]\/div\/div[4]\/span\/div[2]\/div[1]\/div\/div[1]\/button[2]\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='ecc_agent_ip_range.name']\").send_keys(\"Prism Central\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='ecc_agent_ip_range.range']\").send_keys(\"@@{PC_IP}@@\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\nprint('Added PC to MID Server IP Range')\ntime.sleep(10)\nbrowser.find_element_by_xpath(\"\/\/*[@id='tabs2_list']\/span[5]\/span\/span[2]\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/html\/body\/div[2]\/div[2]\/div\/div[5]\/span\/div[2]\/div[1]\/div\/div[1]\/button[2]\").click()\ntime.sleep(3)\n#browser.find_element_by_xpath(\"\/\/*[@id='_ecc_agent_capability']\").send_keys(\"ALL\")\nbrowser.find_element_by_xpath(\"\/\/*[text()='ALL']\").click() \ntime.sleep(3)\nbrowser.find_element_by_id(\"add_to_collection_button\").click()\ntime.sleep(5)\nbrowser.find_element_by_id(\"select_0_sysverb_save\").click()\ntime.sleep(5)\nbrowser.find_element_by_id(\"sysverb_update\").click()\nprint('Added ALL MID Server Capability')\ntime.sleep(5)\n\nbrowser.quit()\nEOF\n\npython3 \/tmp\/ValidateMid.py","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"CalmPluginConfig","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/CalmConfig.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nfrom selenium.webdriver.common.keys import Keys\nimport os, sys, time\n\noptions = Options()\noptions.headless = True\nprofile = webdriver.FirefoxProfile()\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(20)\n\n# Service Now instance id need to be changes in the url\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\/nav_to.do?\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\nchange_app_url = \"https:\/\/@@{SNOWInstanceURL}@@\/change_current_app.do?app_id=3b7631654f452b001200e5201310c76b\"\napplication_property_url = \"https:\/\/@@{SNOWInstanceURL}@@\/x_nuta2_nutanix_ca_calm_plugin_configuration.do?sys_id=32fe0ea73785a300fdfc097973990ead&sysparm_view=&sysparm_record_target=&sysparm_record_row=1&sysparm_record_list=&sysparm_record_rows=1\"\ncalm_url = \"https:\/\/@@{PC_IP}@@:9440\/\"\n\n###Login to the ServiceNow Instance\nbrowser.get(snow_url)\ntime.sleep(30)\nbrowser.switch_to.frame('gsft_main')\ntime.sleep(5)\nbrowser.find_element_by_id(\"user_name\").send_keys(snow_username)\nbrowser.find_element_by_id(\"user_password\").send_keys(snow_password)\nbrowser.find_element_by_id(\"sysverb_login\").click()\nprint('Logged in to SNOW')\nbrowser.switch_to_default_content()\n\nbrowser.get(change_app_url)\ntime.sleep(30)\nbrowser.get(application_property_url)\ntime.sleep(30)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.mid_server']\").send_keys(\"@@{VM1.name}@@\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.mid_server']\").send_keys(Keys.ENTER)\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_instance_unlock']\/span[1]\").click()\ntime.sleep(2)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.workflow']\").clear()\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.workflow']\").send_keys(\"Nutanix Calm - User Approval\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.workflow']\").send_keys(Keys.ENTER)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.assignment_group']\").clear()\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.assignment_group']\").send_keys(\"Service Desk\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.x_nuta2_nutanix_ca_calm_plugin_configuration.assignment_group']\").send_keys(Keys.ENTER)\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_instance']\").clear()\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_instance']\").send_keys(calm_url)\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_instance_lock']\").click()\ntime.sleep(2)\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_admin_username']\").clear()\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_admin_username']\").send_keys(\"admin\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_admin_password']\").clear()\nbrowser.find_element_by_xpath(\"\/\/*[@id='x_nuta2_nutanix_ca_calm_plugin_configuration.calm_admin_password']\").send_keys(\"@@{PrismAdminPassword}@@\")\nif \"@@{CleanInstance}@@\" == \"TRUE\":\n\tbrowser.find_element_by_xpath(\"\/\/*[@id='label.ni.x_nuta2_nutanix_ca_calm_plugin_configuration.use_local_groups']\").click()\nbrowser.find_element_by_id(\"save_properties\").click()\ntime.sleep(60)\nprint('Calm Config Updated')\nbrowser.find_element_by_id(\"nutanix_sync_bottom\").click()\ntime.sleep(10)\nalert = browser.switch_to.alert\nalert.accept()\ntime.sleep(10)\nprint('Calm data syncing to SNOW')\nbrowser.quit()\nEOF\n\npython3 \/tmp\/CalmConfig.py","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SNOWCMDBConfig","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/CMDBConfig.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nfrom selenium.webdriver.common.keys import Keys\nimport os, sys, time\n\noptions = Options()\noptions.headless = True\nprofile = webdriver.FirefoxProfile()\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(20)\n\n# Service Now instance id need to be changes in the url\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\/nav_to.do?\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\nsnow_discovery_creds_url = \"https:\/\/@@{SNOWInstanceURL}@@\/basic_auth_credentials.do\"\nsnow_http_class_url = \"https:\/\/@@{SNOWInstanceURL}@@\/discovery_classy_http_list.do\"\nsnow_discovery_sched_url = \"https:\/\/@@{SNOWInstanceURL}@@\/discovery_schedule.do\"\nsnow_cred_alias_url = \"https:\/\/@@{SNOWInstanceURL}@@\/sys_alias.do\"\nsnow_sched_list_url = \"https:\/\/@@{SNOWInstanceURL}@@\/discovery_schedule_list.do\"\n\n###Login to the ServiceNow Instance\nbrowser.get(snow_url)\ntime.sleep(30)\n#frame = browser.find_element_by_xpath\nbrowser.switch_to.frame('gsft_main')\ntime.sleep(5)\nbrowser.find_element_by_id(\"user_name\").send_keys(snow_username)\nbrowser.find_element_by_id(\"user_password\").send_keys(snow_password)\nbrowser.find_element_by_id(\"sysverb_login\").click()\nprint('Logged in to SNOW')\nbrowser.switch_to_default_content()\n\n###Create Nutanix Prism basic auth credentials for CMDB discovery\nbrowser.get(snow_cred_alias_url)\ntime.sleep(30)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_alias.name']\").send_keys(\"NutanixPrism\")\nbrowser.find_element_by_xpath(\"\/\/select[@name='sys_alias.type']\/option[text()='Credential']\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\ntime.sleep(10)\nbrowser.get(snow_discovery_creds_url)\ntime.sleep(30)\nbrowser.find_element_by_xpath(\"\/\/*[@id='basic_auth_credentials.name']\").send_keys(\"Nutanix Prism\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='basic_auth_credentials.user_name']\").send_keys(\"admin\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='basic_auth_credentials.password']\").send_keys(\"@@{PrismAdminPassword}@@\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='basic_auth_credentials.tag_unlock']\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.basic_auth_credentials.tag']\").send_keys(\"x_nuta2_nutanix_ca.NutanixPrism\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.basic_auth_credentials.tag']\").send_keys(Keys.ENTER)\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\ntime.sleep(10)\nprint('Prism Basic Auth credential created')\n\n###Create Nutanix HTTP classification for CMDB discovery\nbrowser.get(snow_http_class_url)\ntime.sleep(30)\nbrowser.find_element_by_id(\"sysverb_new\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='discovery_classy_http.name']\").send_keys(\"Nutanix\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='discovery_classy_http.path']\").send_keys(\"\/\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='discovery_classy_http.port_unlock']\").click()\ntime.sleep(1)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.discovery_classy_http.port']\").send_keys(\"Nutanix\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.discovery_classy_http.port']\").send_keys(Keys.ENTER)\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\ntime.sleep(10)\nprint('Nutanix HTTP classification created')\n\n###Create Discovery Schedule for Nutanix CMDB discovery\nbrowser.get(snow_discovery_sched_url)\ntime.sleep(30)\nbrowser.find_element_by_xpath(\"\/\/*[@id='discovery_schedule.name']\").send_keys(\"Nutanix\")\nbrowser.find_element_by_xpath(\"\/\/select[@name='discovery_schedule.discover']\/option[text()='Serverless']\").click()\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.discovery_schedule.mid_server']\").send_keys(\"SNOWMID\")\nbrowser.find_element_by_xpath(\"\/\/*[@id='sys_display.discovery_schedule.mid_server']\").send_keys(Keys.ENTER)\nbrowser.find_element_by_xpath(\"\/\/select[@name='discovery_schedule.disco_run_type']\/option[text()='Daily']\").click()\ntime.sleep(3)\nbrowser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\ntime.sleep(10)\nfor x in range(3):\n    try:\n        browser.get(snow_sched_list_url)\n        time.sleep(30)\n        browser.find_element_by_link_text(\"Nutanix\").click()\n        time.sleep(10)\n        browser.find_element_by_xpath(\"\/\/*[@id='tabs2_list']\/span[6]\/span\/span[2]\").click()\n        time.sleep(3)\n        browser.find_element_by_xpath(\"\/html\/body\/div[2]\/div[2]\/div\/div[6]\/span\/div[2]\/div[1]\/div\/div[1]\/button[2]\").click()\n        time.sleep(5)\n        browser.find_element_by_xpath(\"\/\/*[@id='discovery_ptrn_hostless_lchr.name']\").send_keys(\"Nutanix Pattern\")\n        browser.find_element_by_xpath(\"\/\/*[@id='sys_display.discovery_ptrn_hostless_lchr.pattern']\").send_keys(\"Nutanix Components\")\n        time.sleep(3)\n        browser.find_element_by_xpath(\"\/\/*[@id='sysverb_insert']\").click()\n        time.sleep(15)\n        browser.find_element_by_link_text(\"Nutanix Pattern\").click()\n        time.sleep(10)\n        browser.find_element_by_link_text(\"(empty)\").click()\n        time.sleep(5)\n        browser.find_element_by_xpath(\"\/\/*[@id='discovery_ptrn_lnch_param.value']\").send_keys(\"@@{PC_IP}@@\")\n        browser.find_element_by_xpath(\"\/\/*[@id='sysverb_update']\").click()\n        time.sleep(10)\n        browser.find_element_by_xpath(\"\/\/*[@id='sysverb_update']\").click()\n        time.sleep(10)\n        break\n    except:\n        print('Nutanix pattern create failed')\n        if x == 2:\n            sys.exit(\"Nutanix pattern create failed 3 times\")\nfor x in range(3):\n    try:\n        browser.get(snow_sched_list_url)\n        time.sleep(30)\n        browser.find_element_by_link_text(\"Nutanix\").click()\n        time.sleep(10)\n        browser.find_element_by_link_text(\"Discover now\").click()\n        print('CMDB Discovery Schedule created, running discovery now')\n        break\n    except:\n        print('Failed to click Discover Now')\n        if x == 2:\n            sys.exit(\"Failed to click Discover Now 3 times\")\n\n######End\nbrowser.quit()\nEOF\n\npython3 \/tmp\/CMDBConfig.py","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MIDServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SNOWChangePW","attrs":{"exit_status":[],"script":"cat <<EOF > \/tmp\/SNOWChangePW.py\nfrom selenium import webdriver\nfrom selenium.webdriver.firefox.options import Options\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.common.action_chains import ActionChains\nimport os, sys, time\n\noptions = Options()\noptions.headless = True\nprofile = webdriver.FirefoxProfile()\nbrowser = webdriver.Firefox(options=options,firefox_profile=profile)\nbrowser.implicitly_wait(30)\n\n# Service Now instance id need to be changes in the url\nsnow_url = \"https:\/\/@@{SNOWInstanceURL}@@\/\"\nsnow_username = \"admin\"\nsnow_password = \"@@{SNOWAdminPassword}@@\"\n\nprint('Cleaning up previous Bootcamp config')\n\ntry:\n    print(\"Logging in to \" + snow_url)\n    ###Login to the ServiceNow Instance\n    browser.get(snow_url + \"\/nav_to.do?\")\n    #frame = browser.find_element_by_xpath\n    browser.switch_to.frame('gsft_main')\n    browser.find_element_by_id(\"user_name\").send_keys(snow_username)\n    browser.find_element_by_id(\"user_password\").send_keys(snow_password)\n    browser.find_element_by_id(\"sysverb_login\").click()\n    print('Logged in to ' + snow_url)\n    browser.switch_to.default_content()\nexcept Exception as e:\n    browser.quit()\n    sys.exit(\"Failure logging in to SNOW: \" + str(e))\n    \ntry:\n    browser.get(snow_url + \"\/sys_user_list.do?sysparm_query=user_nameSTARTSWITHadmin&sysparm_first_row=1&sysparm_view=&sysparm_choice_query_raw=&sysparm_list_header_search=true\")\n    browser.find_element_by_link_text(\"admin\").click()\n    time.sleep(5)\n    browser.find_element_by_id(\"sys_user.user_password\").send_keys(\"@@{PrismAdminPassword}@@\")\n    browser.find_element_by_id(\"sysverb_update\").click()\n    print(\"Password updated for \" + snow_url)\n    time.sleep(30)\nexcept Exception as e:\n    browser.quit()\n    sys.exit(\"Failure updating SNOW admin password: \" + str(e))   \nEOF\npython3 \/tmp\/SNOWChangePW.py","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"50e15231_runbook","main_task_local_reference":{"kind":"app_task","name":"ff04da96_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3356bccf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"661bf580_runbook","main_task_local_reference":{"kind":"app_task","name":"3356bccf_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CENTOS7","version":"","options":{"type":"","name":"CENTOS7","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/Calm\/CentOS-7-x86_64-1908.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"b39046ae_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"VM1"},"variable_list":[],"description":""}],"environment_reference_list":[],"patch_list":[],"description":"","action_list":[],"name":"Default","restore_config_list":[],"snapshot_config_list":[],"variable_list":[{"regex":{"should_validate":false,"value":"^.*$"},"val_type":"STRING","is_mandatory":true,"description":"If you HAVE NOT previously run this Blueprint on your SNOW instance, select TRUE. This will ensure all required plug-ins are installed before configuration (+1.5 hours).\n\nIf you HAVE previously used this SNOW Instance with this Blueprint, select FALSE. This will clean up your existing configuration but will not attempt to re-install existing plugins.","data_type":"BASE","type":"LOCAL","name":"CleanInstance","value":"TRUE","label":"New SNOW Instance?","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":["TRUE","FALSE"]}},{"regex":{"should_validate":true,"value":"^dev\\d{4,7}\\.service-now\\.com$"},"val_type":"STRING","is_mandatory":true,"description":"Replace with your ServiceNow Developer Instance URL (Do NOT include https:\/\/ or any trailing slashes)","data_type":"BASE","type":"LOCAL","name":"SNOWInstanceURL","value":"dev12345.service-now.com","label":"ServiceNow Developer Instance URL","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"This is NOT the same as the password for your ServiceNow Developer account. It is randomly generated when you request a developer instance. If you failed to record the password it can be reset through the ServiceNow Developer Portal.","data_type":"BASE","type":"SECRET","name":"SNOWAdminPassword","value":"","label":"ServiceNow 'admin' Password","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"PrismAdminPassword","value":"","label":"Prism Central 'admin' Password","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PC_IP","value":"","label":"","attrs":{"type":""},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"root"},"type":"USER"},"name":"SNOW-Bootcamp-Paris-orig"},"api_version":"3.0","metadata":{"last_update_time":"1636055699677157","kind":"blueprint","spec_version":2,"creation_time":"1636054768944632","name":"SNOW-Bootcamp-Paris-orig"}}